---
layout: post
title: Add scheduled task and run even if on battery power
date: 2013-03-05 22:04:26.000000000 -08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Code
- Snippets
tags:
- c#
- scheduled tasks
meta:
  _edit_last: '1'
  _syntaxhighlighter_encoded: '1'
  _wpas_done_all: '1'
  _su_title: ''
  _jetpack_related_posts_cache: a:1:{s:32:"8f6677c9d6b0f903e98ad32ec61f8deb";a:2:{s:7:"expires";i:1561852696;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:155;}i:1;a:1:{s:2:"id";i:4394;}i:2;a:1:{s:2:"id";i:265;}}}}
author:
  login: akropp
  email: akropp@gmail.com
  display_name: akropp
  first_name: ''
  last_name: ''
permalink: "/2013/03/05/add-scheduled-task-and-run-even-if-on-battery-power/"
---
<p>Just wanted to share a little helpful snippet in case anyone needs it. To add a scheduled task and make sure it starts even when on battery power do this:</p>
<p>[csharp]<br />
using (var taskService = new TaskService())<br />
{<br />
    TaskDefinition task = taskService.NewTask();</p>
<p>    var action = new ExecAction<br />
    {<br />
        Path = &quot;test.exe&quot;,<br />
        Arguments = &quot;&quot;,<br />
        WorkingDirectory = &quot;&quot;<br />
    };</p>
<p>    task.RegistrationInfo.Description = &quot;Test&quot;;</p>
<p>    var trigger = new TimeTrigger(DateTime.Now);<br />
    trigger.Repetition.Interval = TimeSpan.FromMinutes(5);</p>
<p>    task.Triggers.Add(trigger);</p>
<p>    task.Actions.Add(action);</p>
<p>    task.Settings.DisallowStartIfOnBatteries = false;<br />
    task.Settings.StopIfGoingOnBatteries = false;</p>
<p>    // Register the task in the root folder<br />
    taskService.RootFolder.RegisterTaskDefinition(&quot;test&quot;, task, TaskCreation.CreateOrUpdate, &quot;SYSTEM&quot;, null, TaskLogonType.ServiceAccount, null);<br />
}<br />
[/csharp]</p>
<p>TaskService is part of <a href="http://taskscheduler.codeplex.com/" target="_blank" rel="noopener noreferrer"><code>Microsoft.Win32.TaskScheduler</code></a>.  </p>
<p>By default when you create a new task <code>DisallowStartIfOnBatteries</code> and <code>StartIfGoingOnBatteries</code> are true, so that's something to keep in mind if you are writing code that can be deployed on a laptop and you must have your scheduled task continue to run.</p>
<p>Quick side note, I personally think negative property names are hard to follow (<code>DisallowStartIfOnBatteries</code>). It's hard to follow when it becomes a double negative. I think it would've been much better to name the property</p>
<p>[code]<br />
AllowStartOnBatteries<br />
[/code]</p>
<p>Especially since it has nothing to do with starting the task when its not on batteries.  It's interesting that the UI control for this doesn't use a double negative to display the context (even though the phrasing is logically inverse). Still, case in point</p>
<p><img src="http://onoffswitch.net/wp-content/uploads/2013/03/taskScheduler.-600x451.png" alt="taskScheduler." width="600" height="451" class="alignnone size-medium wp-image-3229" /></p>
