---
layout: post
title: Getting battery percentage in zsh
date: 2015-03-30 01:15:14.000000000 -07:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Code
tags:
- osx
- shell
- zsh
meta:
  _edit_last: '1'
  _syntaxhighlighter_encoded: '1'
  _su_rich_snippet_type: none
  _wpas_done_all: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"8f6677c9d6b0f903e98ad32ec61f8deb";a:2:{s:7:"expires";i:1560766546;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:4631;}i:1;a:1:{s:2:"id";i:4589;}i:2;a:1:{s:2:"id";i:4463;}}}}
author:
  login: akropp
  email: akropp@gmail.com
  display_name: akropp
  first_name: ''
  last_name: ''
permalink: "/2015/03/30/battery-percentage-zsh-osx-maverick/"
---
<p>I'm on osx maverick still at home on my laptop and I spent part of today dicking around customizing my zsh shell.  I wanted to be able to show my battery percentage in the shell and it's really pretty easy.</p>
<p>First, the main shell function </p>
<p>[bash]<br />
function get_battery()<br />
{<br />
    current_battery=`system_profiler SPPowerDataType | grep -i &quot;charge remaining&quot; | awk '{print $4}'`</p>
<p>    max_battery=`system_profiler SPPowerDataType | grep -i &quot;full charge capacity&quot; | awk '{print $5}'`</p>
<p>    percent=`bc &lt;&lt;&lt; &quot;scale=4; ${current_battery}/${max_battery} * 100&quot;`</p>
<p>    printf '%.0f' $percent<br />
}<br />
[/bash]</p>
<p>This queries from the profiler the charge current and remaining, uses bc to get a floating point division, and then just shows the integer value of that (we could round it too but I was lazy).</p>
<p>Now, we just need to tie it into the prompt. I'm using the <a href="https://github.com/robbyrussell/oh-my-zsh/blob/master/themes/steeef.zsh-theme" target="_blank" rel="noopener noreferrer">steef</a> prompt by default and just tweaked it a bit:</p>
<p>[bash]<br />
battery_percentage=&quot;$(get_battery)%%&quot;</p>
<p>directory_info=&quot;${_prompt_steeef_colors[5]}%~%f&quot; </p>
<p>datetime=&quot;%F{yellow}[%D{\%a %I:%M:%S %p}]%f&quot; # yellow [Day hh:mm:ss am/pm] followed by reset color %f</p>
<p>PROMPT=&quot;${battery_percentage} ${datetime} ${directory_info} ${vcs}<br />
&quot;&quot;$ &quot;</p>
<p>RPROMPT=&quot;&quot;<br />
[/bash]</p>
<p>The two percent symbols just escapes the percent symbol.</p>
<p>Make sure the <code>battery_percentage</code> function is defined before you load your prompt in your .zshrc file. </p>
<p>Now here's what I got:</p>
<p><img src="http://onoffswitch.net/wp-content/uploads/2015/03/Screen-Shot-2015-03-29-at-6.13.50-PM.png" alt="Screen Shot 2015-03-29 at 6.13.50 PM" width="356" height="63" class="aligncenter size-full wp-image-4623" /></p>
